<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Questloggd - User Profile</title>
    <style>
        /* Reset */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #121212;
            color: #f0f0f0;
        }

        /* Header */
        header {
            background-color: #2e005e;
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 30px;
        }

        header a {
            color: #fff;
            text-decoration: none;
            font-weight: bold;
            transition: color 0.2s;
        }

        header a:hover {
            color: #ff69b4;
        }

        /* Main layout */
        .container {
            display: flex;
            padding: 20px 30px;
            gap: 20px;
        }

        /* Left sidebar */
        .sidebar {
            width: 25%;
            background-color: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
        }

        .profile-pic {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            margin: 0 auto 10px;
            display: block;
            object-fit: cover;
        }

        .username {
            text-align: center;
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        /* Level + EXP bar */
        .level-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .level-number {
            font-size: 1.5em;
            font-weight: bold;
            min-width: 20px;
        }

        .exp-bar {
            width: 100px;
            height: 12px;
            background-color: #2a2a2a;
            border-radius: 6px;
            overflow: hidden;
        }

        .exp-progress {
            height: 100%;
            background-color: #ffcc00;
            border-radius: 6px;
        }

        .bio {
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 0.9em;
            text-align: center;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #ccc;
        }

        .stats div {
            text-align: center;
        }

        /* Followers / Following moved to sidebar */
        .sidebar .followers-following {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .sidebar .followers-following div {
            background-color: #1a1a1a;
            border-radius: 10px;
            padding: 10px;
            flex: 1;
            text-align: center;
        }

        .recent-activity {
            margin-top: 20px;
        }

        .recent-activity h3 {
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .activity-item {
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        /* Right content */
        .main-content {
            width: 75%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section-title {
            font-size: 1.3em;
            color: #ffffff;
            margin-bottom: 10px;
        }

        /* Top 4 games */
        .top-games {
            display: flex;
            gap: 15px;
        }

        .game-card {
            background-color: #1a1a1a;
            border-radius: 10px;
            padding: 15px;
            flex: 1;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

        .game-card:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #ff69b4;
        }

        .game-card img {
            width: 100%;
            height: 120px;
            border-radius: 5px;
            object-fit: fill;
            margin-bottom: 10px;
        }

        .game-name {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .game-rating {
            color: #ffcc00;
        }

        /* Game carousel */
        .game-carousel-container {
            position: relative;
            overflow: hidden;
            border-radius: 10px;
            background-color: #1a1a1a;
            padding: 15px;
        }

        .game-carousel {
            display: flex;
            gap: 10px;
        }

        .carousel-item {
            flex: 0 0 150px;
            height: 150px;
            border-radius: 5px;
            overflow: hidden;
        }

        .carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: fill;
            display: block;
        }

        /* Recent reviews with game image */
        .recent-reviews {
            background-color: #1a1a1a;
            border-radius: 10px;
            padding: 15px;
        }

        .review-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background-color: #2a2a2a;
            border-radius: 5px;
        }

        .review-game-img {
            width: 50px;
            height: 50px;
            object-fit: fill;
            border-radius: 5px;
        }

        .review-text {
            flex: 1;
        }

        /* Hide carousel scrollbar */
        .game-carousel::-webkit-scrollbar {
            display: none;
        }

        /* Overlay + modal */
.log-overlay{
  position:fixed; inset:0; display:flex; align-items:flex-start; justify-content:center;
  background:rgba(0,0,0,.6); padding:64px 16px; z-index:9999;
}
.hidden{ display:none; }

.log-modal{
  width:min(940px, 100%);
  max-height: 90vh;                 /* <= cap overall height */
  display:flex;                     /* header fixed, body scrolls */
  flex-direction: column;
  background:#3c4d60; color:#e8f0ff;
  border-radius:10px; box-shadow:0 40px 80px rgba(0,0,0,.55); overflow:hidden;
}
.log-modal-head{
  flex:none;
  display:flex; align-items:center; justify-content:space-between;
  padding:18px 24px; border-bottom:1px solid rgba(255,255,255,.08);
}
.log-close{
  background:transparent; border:0; color:#a8bbd0; font-size:22px; cursor:pointer;
}
.log-close:hover{ color:#fff; }

.log-modal-body{
  position: relative;
  flex:1 1 auto;                    /* grow and allow scroll */
  overflow:auto;                    /* <= important */
  padding:36px 24px 40px;
  background:#3c4d60;
}

/* Search box + results dropdown */
.log-searchbox{ position:relative; max-width:820px; margin:0 auto; }
#log-search{
  width:100%; height:52px; border-radius:8px; border:2px solid rgba(255,255,255,.2);
  background:#dbeaff; color:#153047; padding:0 14px; font-size:18px;
}
#log-search::placeholder{ color:#6c7f95; }

.log-results{
  position:absolute; left:0; right:0; top:60px;
  max-height:50vh;                  /* <= will scroll inside modal */
  overflow:auto;
  background:#455a73; border:1px solid rgba(255,255,255,.12); border-radius:8px;
  box-shadow:0 12px 28px rgba(0,0,0,.35);
}
.log-item{ display:flex; align-items:center; gap:12px; padding:10px 12px; cursor:pointer; color:#e8f0ff; }
.log-item:hover, .log-item.active{ background:#1bb04b; }
.log-thumb{ width:40px; height:40px; border-radius:6px; object-fit:cover; background:#223144; }
.log-meta{ font-size:14px; color:#c9d6e5; }

/* keep the header visible while body scrolls */
.log-modal { max-height: 92vh; }
.log-modal-head { position: sticky; top: 0; background: #3c4d60; z-index: 2; }

/* make the dropdown always stay within the modal viewport */
.log-searchbox { position: sticky; top: 16px; z-index: 1; }
.log-results { max-height: min(55vh, 560px); }

    </style>
</head>


<body>
    <header>
        <a href="#">Profile</a>
        <a href="#">Lists</a>
        <a href="#">Games</a>
        <a href="#">Friends</a>
        <a href="#">Settings</a>
        <a id="log-open"
   href="#"
   style="margin-left:auto; background-color:#8a2be2; padding:3px 8px; border-radius:6px; font-weight:bold;">
  + LOG
</a>
    </header>

    

    <div class="container">
        <!-- Left Sidebar -->
        <div class="sidebar">
            <img src="images/profile.jpg" alt="Profile Picture" class="profile-pic">
            <div class="username">Username123</div>

            <!-- Level + EXP bar -->
            <div class="level-container">
                <div class="level-number">12</div>
                <div class="exp-bar">
                    <div class="exp-progress" style="width: 70%;"></div>
                </div>
            </div>

            <div class="bio">
                Gamer. Reviewer. Explorer of virtual worlds. Love RPGs and indie games!
            </div>

            <div class="stats">
                <div>
                    <strong>45</strong><br>Games Played
                </div>
                <div>
                    <strong>8</strong><br>Lists Created
                </div>
            </div>

            <!-- Followers / Following -->
            <div class="followers-following">
                <div>
                    <h4>Followers</h4>
                    <p>123</p>
                </div>
                <div>
                    <h4>Following</h4>
                    <p>98</p>
                </div>
            </div>

            <div class="recent-activity">
                <h3>Recent Activity</h3>
                <div class="activity-item">Played Game A</div>
                <div class="activity-item">Reviewed Game B</div>
                <div class="activity-item">Added Game C to wishlist</div>
            </div>
        </div>

        <!-- Right Main Content -->
        <div class="main-content">
            <!-- Favourite Games -->
            <div>
                <h2 class="section-title">Favourite Games</h2>
                <div class="top-games">
                    <div class="game-card">
                        <img src="images/game1.jpg" alt="Game 1">
                        <div class="game-name">Overwatch 2</div>
                        <div class="game-rating">★ ★ ★ ★ ☆</div>
                    </div>
                    <div class="game-card">
                        <img src="images/game2.jpg" alt="Game 2">
                        <div class="game-name">Marvel Rivals</div>
                        <div class="game-rating">★ ★ ★ ☆ ☆</div>
                    </div>
                    <div class="game-card">
                        <img src="images/game3.jpg" alt="Game 3">
                        <div class="game-name">Battlefield 6</div>
                        <div class="game-rating">★ ★ ★ ★ ★</div>
                    </div>
                    <div class="game-card">
                        <img src="images/game4.jpg" alt="Game 4">
                        <div class="game-name">Risk of Rain 2</div>
                        <div class="game-rating">★ ★ ☆ ☆ ☆</div>
                    </div>
                </div>
            </div>

            <!-- Recently Played Carousel -->
            <div>
                <h2 class="section-title">Recently Played</h2>
                <div class="game-carousel-container">
                    <div class="game-carousel" id="carousel">
                        <div class="carousel-item"><img src="images/carousel1.jpg" alt="Game 1"></div>
                        <div class="carousel-item"><img src="images/carousel2.jpg" alt="Game 2"></div>
                        <div class="carousel-item"><img src="images/carousel3.jpg" alt="Game 3"></div>
                        <div class="carousel-item"><img src="images/carousel4.jpg" alt="Game 4"></div>
                        <div class="carousel-item"><img src="images/carousel5.jpg" alt="Game 5"></div>
                        <div class="carousel-item"><img src="images/carousel6.jpg" alt="Game 6"></div>
                    </div>
                </div>
            </div>

            <!-- Recent Reviews -->
            <div class="recent-reviews">
                <h3>Recent Reviews</h3>
                <div class="review-item">
                    <img src="images/gameA_small.jpg" alt="Game A" class="review-game-img">
                    <div class="review-text"><strong>Game A:</strong> Loved the graphics!</div>
                </div>
                <div class="review-item">
                    <img src="images/gameB_small.jpg" alt="Game B" class="review-game-img">
                    <div class="review-text"><strong>Game B:</strong> Gameplay was smooth.</div>
                </div>
                <div class="review-item">
                    <img src="images/gameC_small.jpg" alt="Game C" class="review-game-img">
                    <div class="review-text"><strong>Game C:</strong> Needs better controls.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const carousel = document.getElementById('carousel');
        const container = carousel.closest('.game-carousel-container');

        // Duplicate carousel items for seamless scrolling
        carousel.innerHTML += carousel.innerHTML;

        let offset = 0;

        function slideCarousel() {
            offset += 1; // scroll speed

            // Reset offset when it has scrolled one full set
            if (offset >= carousel.scrollWidth / 2) {
                offset = 0;
            }

            carousel.style.transform = `translateX(-${offset}px)`;
        }

        setInterval(slideCarousel, 20);
    </script>

    <!-- LOG SEARCH MODAL -->
<div id="log-overlay" class="log-overlay hidden" aria-hidden="true">
  <div class="log-modal" role="dialog" aria-modal="true" aria-labelledby="log-title">
    <div class="log-modal-head">
      <h2 id="log-title">Add to your games…</h2>
      <button id="log-close" class="log-close" aria-label="Close">✕</button>
    </div>

    <div class="log-modal-body">
      <div class="log-searchbox">
        <input id="log-search" type="text" placeholder="Search for a game…" autocomplete="off" />
        <div id="log-results" class="log-results" style="display:none"></div>
      </div>
    </div>
  </div>
</div>

<!-- REVIEW MODAL -->
<div id="review-overlay" class="log-overlay hidden" aria-hidden="true">
  <div class="log-modal" role="dialog" aria-modal="true" aria-labelledby="rev-title">
    <div class="log-modal-head">
      <button id="rev-back" class="log-close" aria-label="Back">← BACK</button>
      <h2 id="rev-title">I played…</h2>
      <button id="rev-close" class="log-close" aria-label="Close">✕</button>
    </div>

    <div class="log-modal-body">
      <div style="display:flex; gap:20px; align-items:flex-start;">
        <img id="rev-cover" src="" alt="" style="width:200px; border-radius:8px; object-fit:cover; background:#223144;">
        <div style="flex:1;">
          <h1 id="rev-name" style="margin:0 0 6px 0;"></h1>
          <div id="rev-year" style="opacity:.85; margin-bottom:14px;"></div>

          <label style="display:flex; align-items:center; gap:10px; margin:8px 0 16px;">
            <input id="rev-date-enabled" type="checkbox" checked>
            Watched/Played on
            <input id="rev-date" type="date">
          </label>

          <textarea id="rev-text" placeholder="Add a review…" rows="8"
                    style="width:100%; resize:vertical; border-radius:8px; border:1px solid #3a4450;
                           background:#0f141a; color:#e7eef5; padding:12px;"></textarea>

          <div style="display:flex; gap:24px; align-items:center; margin-top:16px;">
            <div>
              <div style="font-weight:600; margin-bottom:6px;">Rating</div>
              <div id="rev-stars" aria-label="Rating" style="font-size:28px; cursor:pointer;">
                ★★★★★
              </div>
            </div>

            <div>
              <div style="font-weight:600; margin-bottom:6px;">Tags</div>
              <input id="rev-tags" placeholder="eg. pc, coop" 
                     style="height:40px; border-radius:8px; border:1px solid #3a4450;
                            background:#0f141a; color:#e7eef5; padding:0 12px; width:260px;">
            </div>

            <button id="rev-save" class="btn btn-green" style="margin-left:auto; height:42px; padding:0 18px;">
              SAVE
            </button>
          </div>

          <p id="rev-msg" class="msg" style="margin-top:10px;"></p>
        </div>
      </div>
    </div>
  </div>
</div>



<script>
  // OPEN/CLOSE
  const openBtn = document.getElementById('log-open');
  const overlay = document.getElementById('log-overlay');
  const closeBtn = document.getElementById('log-close');
  const search   = document.getElementById('log-search');
  const results  = document.getElementById('log-results');

  function openModal(){
    overlay.classList.remove('hidden');
    overlay.setAttribute('aria-hidden','false');
    setTimeout(()=> search.focus(), 0);
  }
  function closeModal(){
    overlay.classList.add('hidden');
    overlay.setAttribute('aria-hidden','true');
    results.style.display = 'none';
    results.innerHTML = '';
    search.value = '';
  }

  openBtn?.addEventListener('click', e => { e.preventDefault(); openModal(); });
  closeBtn?.addEventListener('click', closeModal);
  overlay?.addEventListener('click', e => {
    if (e.target === overlay) closeModal(); // click outside to close
  });
  document.addEventListener('keydown', e => {
    if (!overlay || overlay.classList.contains('hidden')) return;
    if (e.key === 'Escape') closeModal();
  });

  // SEARCH (debounced)
  let t, selIndex = -1;
  function debounce(fn, ms=300){ clearTimeout(t); t = setTimeout(fn, ms); }

  search.addEventListener('input', () => {
    const q = search.value.trim();
    selIndex = -1;
    if (!q){ results.style.display='none'; results.innerHTML=''; return; }
    debounce(async () => {
      try{
        const r = await fetch(`http://localhost:3000/games/search?q=${encodeURIComponent(q)}`);
        const data = await r.json();
        renderResults(data);
      }catch(err){ console.log(err); }
    }, 250);
  });

  function renderResults(list){
    if (!list.length){ results.style.display='none'; results.innerHTML=''; return; }
    results.innerHTML = list.map((g,i)=>`
      <div class="log-item" data-i="${i}" data-id="${g.id}" data-name="${g.name}" data-year="${g.year||''}" data-img="${g.image||''}">
        <img class="log-thumb" src="${g.image||''}" alt="">
        <div>
          <div>${g.name}</div>
          <div class="log-meta">${g.year||''}</div>
        </div>
      </div>
    `).join('');
    results.style.display = 'block';
  }

  // Click select
  results.addEventListener('click', (e)=>{
    const row = e.target.closest('.log-item');
    if (!row) return;
    choose(row);
  });

  // Keyboard navigation (↑/↓/Enter)
  search.addEventListener('keydown', (e)=>{
    const items = [...results.querySelectorAll('.log-item')];
    if (!items.length) return;

    if (e.key === 'ArrowDown'){ e.preventDefault(); selIndex = Math.min(selIndex+1, items.length-1); highlight(items); }
    if (e.key === 'ArrowUp'){   e.preventDefault(); selIndex = Math.max(selIndex-1, 0);           highlight(items); }
    if (e.key === 'Enter' && selIndex >= 0){ e.preventDefault(); choose(items[selIndex]); }
  });

  function highlight(items){
    items.forEach(el => el.classList.remove('active'));
    if (selIndex >= 0) items[selIndex].classList.add('active');
    // auto-scroll into view
    const el = items[selIndex];
    if (el) el.scrollIntoView({ block:'nearest' });
  }

  function choose(row){
  openReview({
    id:   row.dataset.id,
    name: row.dataset.name,
    year: row.dataset.year || '',
    image: row.dataset.img  || ''
  });
}

  // --- Review modal controls ---
const reviewOverlay = document.getElementById('review-overlay');
const revClose  = document.getElementById('rev-close');
const revBack   = document.getElementById('rev-back');
const revCover  = document.getElementById('rev-cover');
const revName   = document.getElementById('rev-name');
const revYear   = document.getElementById('rev-year');
const revDateEn = document.getElementById('rev-date-enabled');
const revDate   = document.getElementById('rev-date');
const revText   = document.getElementById('rev-text');
const revStars  = document.getElementById('rev-stars');
const revTags   = document.getElementById('rev-tags');
const revSave   = document.getElementById('rev-save');
const revMsg    = document.getElementById('rev-msg');

let selected = { id:null, name:'', year:'', image:'', rating:0 };

function openReview(game){
  selected = { ...game, rating: 0 };
  revCover.src = game.image || '';
  revName.textContent = game.name || '';
  revYear.textContent = game.year ? String(game.year) : '';
  revDate.valueAsDate = new Date();
  revText.value = '';
  paintStars(0);
  revMsg.textContent = '';

  // swap modals
  closeModal(); // close search
  reviewOverlay.classList.remove('hidden');
  reviewOverlay.setAttribute('aria-hidden','false');
}

function closeReview(){
  reviewOverlay.classList.add('hidden');
  reviewOverlay.setAttribute('aria-hidden','true');
}

revClose?.addEventListener('click', closeReview);
revBack?.addEventListener('click', () => {
  closeReview();
  openModal(); // go back to search
});
reviewOverlay?.addEventListener('click', e => { if (e.target === reviewOverlay) closeReview(); });
document.addEventListener('keydown', e => {
  if (!reviewOverlay || reviewOverlay.classList.contains('hidden')) return;
  if (e.key === 'Escape') closeReview();
});

// Stars (click to set 1..5)
function paintStars(n){
  revStars.textContent = '★★★★★'.split('').map((ch,i)=> i<n? '★':'☆').join('');
}
revStars.addEventListener('mousemove', e => {
  const box = revStars.getBoundingClientRect();
  const rel = (e.clientX - box.left)/box.width;
  const hover = Math.min(5, Math.max(1, Math.ceil(rel*5)));
  paintStars(hover);
});
revStars.addEventListener('mouseleave', ()=> paintStars(selected.rating||0));
revStars.addEventListener('click', e => {
  const box = revStars.getBoundingClientRect();
  const rel = (e.clientX - box.left)/box.width;
  selected.rating = Math.min(5, Math.max(1, Math.ceil(rel*5)));
  paintStars(selected.rating);
});

// SAVE → send to backend, then redirect to profile (this page)
revSave.addEventListener('click', async () => {
  revMsg.textContent = 'Saving…';
  try{
    const res = await fetch('http://localhost:3000/logs', {
      method: 'POST',
      headers: { 'Content-Type':'application/json' },
      body: JSON.stringify({
        gameId: selected.id,
        name: selected.name,
        year: selected.year,
        image: selected.image,
        date: revDateEn.checked ? revDate.value : null,
        review: revText.value.trim(),
        rating: selected.rating,
        tags: revTags.value.trim()
      })
    });
    const data = await res.json();
    if (res.ok){
      revMsg.textContent = 'Logged! Redirecting…';
      // You can also update the profile UI in-place instead of reloading
      setTimeout(()=> window.location.href = 'quest_user.html', 600);
    } else {
      revMsg.textContent = data?.message || 'Could not save.';
    }
  }catch(err){
    revMsg.textContent = 'Network error.';
  }
});




</script>


</body>
</html>
