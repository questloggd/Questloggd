<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Questloggd - User Profile</title>

<link rel="stylesheet" href="styles.css">
<style>
    
body {
    background-color: #121212;
    color: #f0f0f0;
}

/* Main layout */
.container {
    display: flex;
    padding: 20px 30px;
    gap: 20px;
}

/* Left sidebar */
.sidebar {
    width: 25%;
    background-color: #1a1a1a;
    border-radius: 10px;
    padding: 20px;
}

.profile-pic {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    margin: 0 auto 10px;
    display: block;
    object-fit: cover;
}

.username {
    text-align: center;
    font-size: 1.5em;
    margin-bottom: 5px;
}

/* Level + EXP bar */
.level-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
}

.level-number {
    font-size: 1.5em;
    font-weight: bold;
    min-width: 20px;
}

.exp-bar {
    width: 100px;
    height: 12px;
    background-color: #2a2a2a;
    border-radius: 6px;
    overflow: hidden;
}

.exp-progress {
    height: 100%;
    background-color: #ffcc00;
    border-radius: 6px;
}

.bio {
    background-color: #2a2a2a;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 15px;
    font-size: 0.9em;
    text-align: center;
}

.stats {
    display: flex;
    justify-content: space-around;
    margin-bottom: 10px;
    font-size: 0.9em;
    color: #ccc;
}

.stats div {
    text-align: center;
}

/* Followers / Following */
.sidebar .followers-following {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
}

.sidebar .followers-following div {
    background-color: #1a1a1a;
    border-radius: 10px;
    padding: 10px;
    flex: 1;
    text-align: center;
}

.recent-activity {
    margin-top: 20px;
}

.recent-activity h3 {
    margin-bottom: 10px;
    font-size: 1.1em;
}

.activity-item {
    background-color: #2a2a2a;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 8px;
    font-size: 0.9em;
}

/* Right content */
.main-content {
    width: 75%;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.section-title {
    font-size: 1.3em;
    color: #ffffff;
    margin-bottom: 10px;
}

/* Top 4 games */
.top-games {
    display: flex;
    gap: 15px;
}

.game-card {
    background-color: #1a1a1a;
    border-radius: 10px;
    padding: 15px;
    flex: 1;
    text-align: center;
    transition: transform 0.3s, box-shadow 0.3s;
    cursor: pointer;
}

.game-card:hover {
    transform: scale(1.05);
    box-shadow: 0 0 15px #ff69b4;
}

.game-card img {
    width: 100%;
    height: 120px;
    border-radius: 5px;
    object-fit: cover;
    margin-bottom: 10px;
}

.game-name {
    font-weight: bold;
    margin-bottom: 5px;
}

.game-rating {
    color: #ffcc00;
}

/* Game carousel */
.game-carousel-container {
    position: relative;
    overflow: hidden;
    border-radius: 10px;
    background-color: #1a1a1a;
    padding: 15px;
}

.game-carousel {
    display: flex;
    gap: 10px;
}

.carousel-item {
    flex: 0 0 150px;
    height: 150px;
    border-radius: 5px;
    overflow: hidden;
}

.carousel-item img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.game-carousel::-webkit-scrollbar {
    display: none;
}

/* Recent reviews section */
.recent-reviews {
    background-color: #1a1a1a;
    border-radius: 10px;
    padding: 15px;
}

.review-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    padding: 10px;
    background-color: #2a2a2a;
    border-radius: 5px;
}

.review-game-img {
    width: 50px;
    height: 50px;
    object-fit: cover;
    border-radius: 5px;
}

.review-text {
    flex: 1;
}

/* -------------------------- */
/* NEW THEME COLOR CLASSES    */
/* -------------------------- */

body.theme-neon {
    background-color: #ff00ff;
    color: #ffffff;
}

body.theme-purple {
    background-color: #3a0070;
    color: #e5d4ff;
}

body.theme-ocean {
    background-color: #003f5c;
    color: #d4f1ff;
}

body.theme-emerald {
    background-color: #003d2e;
    color: #caffd4;
}

/* BADGES */
.badge-container {
    margin-top: 20px;
    background-color: #2a2a2a;
    padding: 10px;
    border-radius: 8px;
}

.badge-container h3 {
    margin-bottom: 10px;
    font-size: 1.1em;
    text-align: center;
}

.badge-list {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
}

.badge {
    padding: 6px 10px;
    background-color: #444;
    border-radius: 6px;
    cursor: pointer;
    transition: 0.2s;
    font-size: 0.8em;
}

.badge.active {
    background-color: #ff69b4;
}

/* Selected badges display */
#selected-badges {
    margin-top: 10px;
    text-align: center;
}

#selected-badges span {
    display: inline-block;
    background-color: #ff69b4;
    padding: 5px 8px;
    border-radius: 5px;
    margin: 3px;
}

/* Red button for logout */
.btn-red {
    background-color: #e74c3c; /* Red */
    color: #fff;               /* White text */
    border: none;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.3s;
}

.btn-red:hover {
    background-color: #c0392b;
}

</style>
</head>
<body>
<header class="topbar">
  <div class="brand">
    <img src="images/logo.png" alt="Questloggd" class="logo" />
    <span class="wordmark">Questloggd</span>
  </div>

  <nav class="navlinks">
    <a href="quest_user.html" class="link">Profile</a>
    <a href="#" class="link">Lists</a>
    <a href="quest_collection.html" class="link">Games</a>
    <a href="#" class="link">Friends</a>
    <a href="#" class="link">Settings</a>
    <a href="daily_challenge.html" class="link" style="color: #FFD700;">Daily Challenge</a>
    <a href="player_challenges.html" class="link" style="color: #00ff9d">Player Challenges</a>
  </nav>
</header>

<div class="container">
    <!-- Left Sidebar -->
    <div class="sidebar">
        <img src="images/profile.jpg" alt="Profile Picture" class="profile-pic">
        <div class="username" id="profile-username">Username</div>

        <div id="selected-badges"></div>

        <div class="level-container">
            <div class="level-number" id="profile-level">0</div>
            <div class="exp-bar">
                <div class="exp-progress" id="profile-exp" style="width: 0%;"></div>
            </div>
        </div>

        <div class="bio" id="profile-bio">Welcome to your profile!</div>

        <div class="stats">
            <div>
                <strong id="games-played">0</strong><br>Games Played
            </div>
            <div>
                <strong id="lists-created">0</strong><br>Lists Created
            </div>
        </div>

        <div class="followers-following">
            <div>
                <h4>Followers</h4>
                <p id="followers-count">0</p>
            </div>
            <div>
                <h4>Following</h4>
                <p id="following-count">0</p>
            </div>
        </div>

        <div class="recent-activity">
            <h3>Recent Activity</h3>
            <div id="recent-activity-items"></div>
        </div>

        <!-- ---------------------------- -->
        <!-- NEW SECTION ADDED AT BOTTOM  -->
        <!-- ---------------------------- -->

        <div class="badge-container">
            <h3>Select Badges (max 3)</h3>
            <div class="badge-list">
                <div class="badge">Veteran</div>
                <div class="badge">Completionist</div>
                <div class="badge">Speedrunner</div>
                <div class="badge">Collector</div>
                <div class="badge">Reviewer</div>
                <div class="badge">Strategist</div>
            </div>
        </div>

        <div class="badge-container">
            <h3>Theme</h3>
            <select id="theme-select" style="width:100%; padding:8px; border-radius:6px;">
                <option value="default">Default</option>
                <option value="neon">Neon Pink</option>
                <option value="purple">Royal Purple</option>
                <option value="ocean">Ocean Blue</option>
                <option value="emerald">Emerald Green</option>
            </select>
        </div>

    </div>

    <!-- Right Main Content -->
    <div class="main-content">
        <button id="log-open" class="btn btn-green" style="width: fit-content; padding:10px 16px;">
            Log a Game
        </button>

        <!-- Favourite Games -->
        <div>
            <h2 class="section-title">Favourite Games</h2>
            <div class="top-games" id="top-games"></div>
        </div>

        <!-- Recently Played Carousel -->
        <div>
            <h2 class="section-title">Recently Played</h2>
            <div class="game-carousel-container">
                <div class="game-carousel" id="carousel"></div>
            </div>
        </div>

        <!-- Recent Reviews -->
        <div class="recent-reviews" id="recent-reviews"></div>

        <div class="profile-actions" style="display: flex; gap: 10px; margin-top: 15px;">
            <button id="export-profile" class="btn btn-green" style="width: fit-content; padding:10px 16px;">
                Export Profile
            </button>
            <button id="logout-btn" class="btn btn-red" style="width: fit-content; padding:10px 16px;">
                Logout
            </button>
        </div>

    </div>
</div>

  <footer class="footer">
    <div class="footer-content">
      <p>© 2025 Questloggd — Powered by 
        <a href="https://rawg.io/apidocs" target="_blank" class="footer-link">RAWG API</a>
      </p>
      <button class="btn btn-green contact-btn"
              onclick="window.location.href='mailto:contact@questloggd.com'">Contact Us</button>
    </div>
  </footer>

<!-- Log & Review Modals -->
<div id="log-overlay" class="hidden" aria-hidden="true">
<div id="log-modal">
    <div id="log-top">
    <h2>Search Game</h2>
    <span id="log-close" style="cursor:pointer;">×</span>
    </div>
    <input id="log-search" type="text" placeholder="Search games..." autocomplete="off">
    <div id="log-results"></div>
</div>
</div>

<div id="review-overlay" class="hidden" aria-hidden="true">
<div id="review-modal">
    <div id="rev-top">
    <h2>Log Game Review</h2>
    <span id="rev-close" style="cursor:pointer;">×</span>
    </div>
    <span id="rev-back">← Back to Search</span>
    <img id="rev-cover" src="" alt="Game Cover">
    <div id="rev-name"></div>
    <div id="rev-year"></div>
    <div id="rev-stars-container">
        <span class="rev-star" data-value="1">☆</span>
        <span class="rev-star" data-value="2">☆</span>
        <span class="rev-star" data-value="3">☆</span>
        <span class="rev-star" data-value="4">☆</span>
        <span class="rev-star" data-value="5">☆</span>
    </div>
    <label>
    <input type="checkbox" id="rev-date-enabled" checked>
    Include date
    </label>
    <input type="date" id="rev-date">
    <input id="rev-tags" type="text" placeholder="Tags (comma separated)">
    <textarea id="rev-text" placeholder="Write your review..."></textarea>
    <button id="rev-save" class="btn btn-green">Save</button>
    <div id="rev-msg"></div>
</div>
</div>

<!-- BADGE + THEME + EXPORT LOGIC -->
<script>
// ------- BADGES -------
const badges = document.querySelectorAll('.badge');
const selectedContainer = document.getElementById('selected-badges');

let selected = [];

badges.forEach(b => {
    b.addEventListener('click', () => {
        const name = b.textContent;

        if (b.classList.contains('active')) {
            b.classList.remove('active');
            selected = selected.filter(x => x !== name);
        } else {
            if (selected.length >= 3) return;
            selected.push(name);
            b.classList.add('active');
        }

        selectedContainer.innerHTML = selected
            .map(x => `<span>${x}</span>`)
            .join('');
    });
});

// ------- THEMES -------
document.getElementById("theme-select").addEventListener("change", (e) => {
    document.body.className = ""; // reset
    if (e.target.value !== "default") {
        document.body.classList.add(`theme-${e.target.value}`);
    }
});

// ------- EXPORT PROFILE -------
document.getElementById("export-profile").addEventListener("click", () => {
    const element = document.body;

    html2canvas(element).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jspdf.jsPDF("p", "mm", "a4");

        const width = pdf.internal.pageSize.getWidth();
        const height = (canvas.height * width) / canvas.width;

        pdf.addImage(imgData, "PNG", 0, 0, width, height);
        pdf.save("profile.pdf");
    });
});

document.getElementById('logout-btn').addEventListener('click', async () => {
    try {
        const res = await fetch('/api/logout', {
            method: 'POST',
            credentials: 'include'
        });

        if (res.ok) {
            // Clear any local storage info (optional)
            localStorage.removeItem('userId');
            // Redirect to login page
            window.location.href = '/login.html';
        } else {
            alert('Logout failed');
        }
    } catch (err) {
        console.error('Logout error:', err);
    }
});

</script>

<!-- external libs needed -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script src="log.js"></script>
<script src="profile.js"></script>
</body>
</html>
